<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube Downloader</title>
<style>
:root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif}
body{margin:0;background:linear-gradient(180deg,#ff4b2b,#ff416c);color:white;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;box-sizing:border-box}
.container{width:100%;max-width:520px;background:rgba(0,0,0,0.12);padding:22px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.4)}
h1{margin:0 0 8px;font-size:20px;color:#fff}
.input{width:100%;padding:10px;border-radius:8px;border:none;font-size:15px;box-sizing:border-box}
.btn{width:100%;margin-top:12px;padding:10px;border-radius:8px;border:none;background:linear-gradient(90deg,#ff6b6b,#ff2d2d);color:#fff;font-weight:700;cursor:pointer}
.result{margin-top:14px;background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;word-break:break-word}
.link{color:#ffe8e8}
</style>
</head>
<body>
<div class="container" role="main">
  <h1>YouTube Downloader</h1>

  <label for="url">YouTube URL</label>
  <input id="url" class="input" type="text" placeholder="https://www.youtube.com/watch?v=..." />
  <div style="display:flex;gap:10px;margin-top:10px;align-items:center">
    <label style="display:flex;align-items:center;gap:8px"><input id="owner" type="checkbox" /> <span style="font-size:13px;color:#ffdede">私はYouTubeダウンロードは違法でないと信じています</span></label>
  </div>

  <button id="btn" class="btn">ダウンロード</button>

  <div id="out" class="result">結果はここに表示されます。</div>
</div>

<script>
// ===== CONFIGURE THIS before deploy to GitHub Pages =====
// Set this to your Render app URL, e.g. https://your-app.onrender.com
const SERVER_URL = "https://ytr-6xdv.onrender.com"; // <- change this to your Render URL if different
// ======================================================

const btn = document.getElementById('btn');
const urlIn = document.getElementById('url');
const out = document.getElementById('out');
const owner = document.getElementById('owner');

function isYoutube(u){
  if(!u||typeof u!=="string") return false;
  const s = u.trim();
  const p = /^(https?:\/\/)?(www\.)?(m\.)?(youtube\.com|youtu\.be|youtube-nocookie\.com)(\/|$)/i;
  if(!p.test(s)) return false;
  try{ const url = new URL(s.startsWith('http')?s:'https://'+s); const host = url.hostname.toLowerCase(); return host.endsWith('youtube.com')||host.endsWith('youtu.be')||host.endsWith('youtube-nocookie.com'); }catch(e){return false;}
}

btn.addEventListener('click', async ()=>{
  out.textContent = '処理中…';
  const u = urlIn.value.trim();
  if(!isYoutube(u)){ out.textContent = '有効なYouTubeのURLを入力してください。'; return; }
  if(!owner.checked){ out.textContent = '信じるチェックを入れてください。'; return; }

  try{
    const res = await fetch(SERVER_URL + '/api/geturl', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ url: u })
    });
    const data = await res.json();
    if(res.ok){
      if(data.urls && data.urls.length){
        out.innerHTML = '<strong>直接再生可能なURL（.googlevideo.com 等）:</strong><br>';
        data.urls.forEach((it)=>{
          const a = document.createElement('a');
          a.href = it;
          a.textContent = (it.length>80)?it.slice(0,80)+'...':it;
          a.target = '_blank'; a.rel = 'noopener';
          a.className = 'link';
          out.appendChild(a);
          out.appendChild(document.createElement('br'));
        });
      } else {
        out.textContent = '取得できる直接URLが見つかりませんでした。';
      }
    } else {
      out.textContent = 'エラー: ' + (data.error || res.status);
    }
  }catch(err){
    out.textContent = '通信エラー: ' + err.message;
  }
});
</script>
</body>
</html>
